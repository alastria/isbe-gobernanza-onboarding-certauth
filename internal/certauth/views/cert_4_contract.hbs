{{define "contract"}}
{{template "preamble"}}
{{template "logobar"}}

<style>
    .contract-input {
        border: none;
        border-bottom: 1px solid #555;
        background-color: #f4f7fa;
        padding: 4px 6px;
        margin: 0 2px;
        font-family: inherit;
        font-size: 0.95em;
        color: #222;
        border-radius: 2px;
        transition: all 0.2s ease;
    }

    .contract-input:focus {
        outline: none;
        border-bottom: 2px solid #2185d0;
        background-color: #e0e7ff;
    }

    select.contract-input {
        padding-right: 20px;
        cursor: pointer;
    }

    .text-center {
        text-align: center;
    }

    summary {
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
    }

    p {
        font-size: 1.2rem;
    }

    p:last-child,
    p:first-child {
        margin-bottom: 1rem;
    }

    input:invalid {
        border: 1px dashed red;
    }

    input:valid {
        border: 1px solid black;
    }
</style>

<div class="ui hidden divider"></div>

<div class="ui container" style="max-width: 1000px;">

    <form id="contract_form" name="contract_form" method="POST" action="{{ .postAction }}">
        {{with .formData}}

        <div class="ui raised segment" style="border-radius:1rem">

            <h1 id="contrato-marco-de-adhesión-a-la-red-isbe"><strong>CONTRATO MARCO DE ADHESIÓN A LA RED ISBE</strong>
            </h1>

            <p>En Madrid, a {{ .TodayDay }} de {{ .TodayMonth }} de {{ .TodayYear }}</p>
            <input type="hidden" name="today_day" value="{{ .TodayDay }}">
            <input type="hidden" name="today_month" value="{{ .TodayMonth }}">
            <input type="hidden" name="today_year" value="{{ .TodayYear }}">

            <h2 class="text-center"><strong>REUNIDOS</strong></h2>

            <!-- IDENTIFICACION ALASTRIA -->
            <p>De una parte, Asociación Consorcio Red Alastria, con domicilio social en
                C/ Alberto Aguilera, 23 (Universidad Pontificia de Comillas-ICADE), 28015-Madrid
                (España), y con N.I.F. número G87936159, inscrita en la Sección Primera del Registro
                Nacional de Asociaciones con el número 616096, y teléfono +34 683 49 37 48
                (en adelante “Alastria” o la “Asociación”).
            </p>

            <!-- IDENTIFICACION PARTICIPANTE -->
            <p>Y de otra parte,
                <input type="text" name="organization_name" placeholder="Denominación del Participante"
                    class="contract-input" style="width: 300px;" autofocus required value="{{ .OrganizationName }}">,
                persona jurídica constituida conforme a las leyes de
                <input type="text" name="organization_country" placeholder="Estado miembro de la UE"
                    class="contract-input" style="width: 250px;" required value="{{ .OrganizationCountry }}">,
                con domicilio social en
                <input type="text" name="organization_address" placeholder="Domicilio social del Participante"
                    class="contract-input" style="width: 350px;" required value="{{ .OrganizationAddress }}">
                y N.I.F. número
                <input type="text" name="organization_nif" placeholder="NIF del Participante" class="contract-input"
                    style="width: 180px;" required value="{{ .OrganizationNif }}">,
                inscrita en el Registro Mercantil de
                <input type="text" name="registry_name" placeholder="Registro Mercantil del Participante"
                    class="contract-input" style="width: 300px;" required>,
                al tomo
                <input type="text" name="registry_volume" placeholder="Tomo" class="contract-input"
                    style="width: 100px;" required>, folio
                <input type="text" name="registry_folio" placeholder="Folio" class="contract-input"
                    style="width: 100px;" required>, hoja
                <input type="text" name="registry_sheet" placeholder="Hoja" class="contract-input" style="width: 100px;"
                    required>,
                representada en este acto por
                <select name="representative_title" class="contract-input" style="width: 60px;">
                    <option value="D.">D.</option>
                    <option value="Dña.">Dña.</option>
                </select>
                <input type="text" name="representative_name" placeholder="Representante del Participante"
                    class="contract-input" style="width: 300px;" required value="{{ .RepresentativeName }}">,
                con correo electrónico
                <input type="email" name="representative_email" placeholder="Correo electrónico del Representante"
                    class="contract-input" style="width: 300px;" required value="{{ .RepresentativeEmail }}">,
                según acredita mediante escritura otorgada ante el Notario de
                <input type="text" name="notary_city" placeholder="Ciudad Notario del Participante"
                    class="contract-input" style="width: 250px;" required>,
                <select name="notary_title" class="contract-input" style="width: 60px;">
                    <option value="D.">D.</option>
                    <option value="Dña.">Dña.</option>
                </select> <input type="text" name="notary_name" placeholder="Notario del Participante"
                    class="contract-input" style="width: 250px;" required>, el <input type="number" name="notary_day"
                    placeholder="Día" class="contract-input" style="width: 60px;" min="1" max="31" required> de
                <select name="notary_month" class="contract-input" style="width: 120px;">
                    <option value=""></option>
                    <option value="Enero">Enero</option>
                    <option value="Febrero">Febrero</option>
                    <option value="Marzo">Marzo</option>
                    <option value="Abril">Abril</option>
                    <option value="Mayo">Mayo</option>
                    <option value="Junio">Junio</option>
                    <option value="Julio">Julio</option>
                    <option value="Agosto">Agosto</option>
                    <option value="Septiembre">Septiembre</option>
                    <option value="Octubre">Octubre</option>
                    <option value="Noviembre">Noviembre</option>
                    <option value="Diciembre">Diciembre</option>
                </select>
                <input type="number" name="notary_year" placeholder="Año" class="contract-input" style="width: 80px;"
                    min="2000" required>, con el número
                <input type="text" name="notary_protocol_number" placeholder="Protocolo" class="contract-input"
                    style="width: 150px;" required> de su protocolo
                (en adelante, el “<strong>Participante</strong>”).
            </p>

            <p>Ambas partes, en adelante denominadas conjuntamente como “<strong>las Partes</strong>”,
                reconocen tener la capacidad jurídica y de obrar necesaria y suficiente para
                contratar y obligarse en la representación que ostentan, en especial para
                formalizar el presente Contrato Marco de Adhesión a la red ISBE. Reconociéndose
                mutuamente tal capacidad, los comparecientes,
            </p>

            <!-- EXPOSICION DE LOS MOTIVOS DEL CONTRATO -->
            <h2 class="text-center"><strong>EXPONEN</strong></h2>

            <ol type="I">
                <li>
                    <p>Que ISBE es una infraestructura de blockchain
                        público-permisionada de ámbito nacional, cuya gobernanza explícita y
                        sistema de niveles de participación garantizan un equilibrio entre la
                        apertura del ecosistema y los requisitos de seguridad, resiliencia y
                        cumplimiento jurídico.</p>
                </li>
                <li>
                    <p>Que la red ISBE opera bajo un modelo público-permisionado, lo que
                        significa que, si bien se trata de una infraestructura abierta y
                        colaborativa, el acceso a ciertas funcionalidades está restringido a
                        participantes autorizados según su nivel de participación (el
                        “<strong>Nivel de Participación</strong>”). El ecosistema se estructura
                        en los siguientes Niveles de Participación :</p>

                    <ol type="a">
                        <li>
                            <p>Nivel 0: Participante Básico.</p>
                        </li>
                        <li>
                            <p>Nivel 1: Observador.</p>
                        </li>
                        <li>
                            <p>Nivel 2: Proveedor de Servicios.</p>
                        </li>
                        <li>
                            <p>Nivel 3: Validador.</p>
                        </li>
                    </ol>
                </li>
                <li>
                    <p>Que cada uno de los referidos Niveles de Participación tiene unas
                        capacidades operativas y responsabilidades específicas dentro de la red
                        ISBE, siendo acumulativos y evolutivos, pudiendo el Participante
                        ostentar simultáneamente más de un Nivel de Participación, de acuerdo
                        con las funciones que desempeñe en la red y las capacidades operativas y
                        responsabilidades asociadas a cada Nivel de Participación. Por ejemplo,
                        un Participante puede actuar simultáneamente como Validador y Proveedor
                        de Servicios, cumpliendo las obligaciones correspondientes a ambos
                        Niveles de Participación.</p>
                </li>
                <li>
                    <p>Que la relación jurídica entre el Participante y la Entidad
                        Gestora (según dicho término queda definido más adelante) se articula a
                        través de la siguiente estructura contractual:</p>

                    <ul>
                        <li>
                            <p>Mediante la suscripción del presente Contrato Marco, el
                                Participante adquiere la condición de Participante Básico y acepta las
                                condiciones generales y políticas de ISBE aplicables a todos los
                                miembros de la red ISBE.</p>
                        </li>
                        <li>
                            <p>Para optar a cualquier otro Nivel de Participación superior
                                (<em>i.e.</em> Observador, Proveedor de Servicios y/o Validador), el
                                Participante deberá suscribir el anexo correspondiente a dicho Nivel de
                                Participación que acompaña el presente Contrato Marco. Cada anexo
                                detallará las facultades, obligaciones y limitaciones propias de ese
                                Nivel de Participación, evitando la necesidad de firmar nuevos contratos
                                independientes en caso de que el Participante quiera modificar su Nivel
                                de Participación.</p>

                            <p>La adhesión del Participante a un anexo se realizará únicamente una
                                vez cumplidos los requisitos aplicables al Nivel de Participación
                                correspondiente y seguirá los procedimientos de solicitud establecidos
                                por la gobernanza de ISBE.</p>

                        </li>
                    </ul>

                </li>
                <li>
                    <p>Que, habiendo llegado ambas partes a un acuerdo respecto a la
                        colaboración del Participante en la red ISBE conforme a lo indicado en
                        los expositivos anteriores, las Partes formalizan el presente
                        <strong>CONTRATO MARCO DE ADHESIÓN A LA RED ISBE</strong> (el
                        “<strong>Contrato Marco</strong>”), que se regirá con arreglo y sujeción
                        a las siguientes,
                    </p>
                </li>
            </ol>

            <!-- ESTIPULACIONES -->
            <div class="ui blue segment">

                {{template "estipulaciones" .}}

                <div class="ui positive message">
                    <div class="ui large checkbox">
                        <input type="checkbox" name="contract_base">
                        <label>Acepto las estipulaciones del contrato marco</label>
                    </div>
                </div>

            </div>

        </div>

        <div class="ui raised segment" style="border-radius:1rem">

            <h1><strong>ANEXOS DEL CONTRATO MARCO</strong></h1>

            <p>En Madrid, a {{ .TodayDay }} de {{ .TodayMonth }} de {{ .TodayYear }}</p>

            <!-- ANEXO I -->
            <div class="ui blue segment">

                {{template "anexo_1" .}}

                <div class="ui positive message">
                    <div class="ui large checkbox">
                        <input type="checkbox" name="contract_anexo_1">
                        <label>Acepto los términos y condiciones del Anexo I</label>
                    </div>
                </div>

                <p><em>(Las cláusulas generales del Contrato Marco continúan aplicando
                        en todo lo no modificado expresamente por este Anexo III.)</em></p>

            </div>

            <div class="ui divider"></div>

            <!-- ANEXO II -->
            <div class="ui blue segment">

                {{template "anexo_2" .}}

                <div class="ui positive message">
                    <div class="ui large checkbox">
                        <input type="checkbox" name="contract_anexo_2">
                        <label>Acepto los términos y condiciones del Anexo II</label>
                    </div>
                </div>

                <p><em>(Las cláusulas generales del Contrato Marco continúan aplicando
                        en todo lo no modificado expresamente por este Anexo II.)</em></p>

            </div>

            <div class="ui divider"></div>

            <!-- ANEXO III -->
            <div class="ui blue segment">

                {{template "anexo_3" .}}

                <div class="ui positive message">
                    <div class="ui large checkbox">
                        <input type="checkbox" name="contract_anexo_3">
                        <label>Acepto los términos y condiciones del Anexo III</label>
                    </div>
                </div>

                <p><em>(Las cláusulas generales del Contrato Marco continúan aplicando
                        en todo lo no modificado expresamente por este Anexo III.)</em></p>

            </div>

        </div>

        <input type="hidden" name="auth_code" value="{{ $.authCode }}">
        <input type="hidden" name="state" value="{{ $.authCodeObj.State }}">


        <div class="ui raised segment" style="border-radius:1rem">

            <h2><strong>GENERACIÓN DEL CONTRATO</strong></h2>

            <div class="ui segment">
                <p>Usa el botón "Genera contrato" para generar un borrador de contrato para que puedas revisarlo y
                    firmarlo en el paso siguiente.</p>
                <div class="ui three spaced buttons">
                    <button id="generate-button" class="ui large black circular button">
                        <i class="check icon"></i> Genera contrato
                    </button>
                    <a class="ui large red circular button"
                        href="{{ $.authCodeObj.RedirectURI }}?error=access_denied&state={{ $.authCodeObj.State }}">
                        <i class="times circle icon"></i> Cancelar
                    </a>
                </div>
            </div>


        </div>

        {{end}}
    </form>

</div>
<script>
    $(document).ready(function () {
        $('#generate-button').on('click', function (e) {
            e.preventDefault();
            debugger;

            var contract_form = document.forms["contract_form"];
            var part = contract_form.elements["participant_name"];

            const data = new FormData(contract_form);
            for (const pair of data.entries()) {
                console.log(pair[0], pair[1]);
            }

            contract_form.submit();
        });


        function fillTestData() {
            var contract_form = document.forms["contract_form"];
            for (const pair of Object.entries(test_data)) {
                contract_form.elements[pair[0]].value = pair[1];
            }
        }
    });

    var test_data = {
        "organization_name": "Good Air S.L.",
        "organization_country": "España",
        "organization_address": "Academia 28",
        "organization_nif": "VATES-12345678K",
        "registry_name": "Madrid",
        "registry_volume": "1",
        "registry_folio": "22",
        "registry_sheet": "333",
        "representative_name": "Perica Perez",
        "representative_email": "jesus@alastria.io",
        "notary_city": "Barcelona",
        "notary_name": "Notillo",
        "notary_day": "23",
        "notary_month": "Mayo",
        "notary_year": "2015",
        "notary_protocol_number": "888888",
    }
</script>

{{template "postamble"}}
{{end}}